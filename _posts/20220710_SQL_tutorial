{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "d1222a23",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T02:22:09.016281Z",
     "start_time": "2022-07-08T02:22:06.788586Z"
    }
   },
   "outputs": [],
   "source": [
    "import pymysql\n",
    "import pandas as pd"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "72056629",
   "metadata": {},
   "source": [
    "## Open Database"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 66,
   "id": "db05339d",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T07:20:57.760743Z",
     "start_time": "2022-07-08T07:20:57.718805Z"
    }
   },
   "outputs": [],
   "source": [
    "db = pymysql.connect(user=\"openalexteam\",\n",
    "                    password= \"openalex.team\",\n",
    "                    host = \"172.18.18.167\",\n",
    "                    port = 3306,\n",
    "                    charset = 'utf8',\n",
    "                    database= 'openalex2022')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "30a0baee",
   "metadata": {},
   "source": [
    "## Select Data from Database"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "976b6fc4",
   "metadata": {},
   "source": [
    "### Basic structure\n",
    " select A_1,A_2,...,A_n from r_1,r_2,...,r_m where R\n",
    " \n",
    " \\* means all attributes in the table.\n",
    " \n",
    " 可以用```as``` 来给每一列取名"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "id": "3514d446",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T06:35:16.691895Z",
     "start_time": "2022-07-08T06:35:16.669306Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>issn</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>V100000117</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>V1000025471</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>V1000112711</td>\n",
       "      <td>[\"1867-5778\"]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>V100014387</td>\n",
       "      <td>[\"1874-3919\", \"1876-7737\"]</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>V100014455</td>\n",
       "      <td>[\"1756-0500\"]</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            id                        issn\n",
       "0   V100000117                            \n",
       "1  V1000025471                            \n",
       "2  V1000112711               [\"1867-5778\"]\n",
       "3   V100014387  [\"1874-3919\", \"1876-7737\"]\n",
       "4   V100014455               [\"1756-0500\"]"
      ]
     },
     "execution_count": 57,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select id, issn from openalex2022.venues limit 5\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "989c4e83",
   "metadata": {},
   "source": [
    "### Constraints\n",
    "多个判断时用逻辑连接词直接连接： ```and,or,in()```\n",
    "\n",
    "String; 单双引号均可"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "id": "43cc5191",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T06:36:44.852127Z",
     "start_time": "2022-07-08T06:36:44.817382Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>ror</th>\n",
       "      <th>display_name</th>\n",
       "      <th>type</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>I100005738</td>\n",
       "      <td>https://ror.org/047rhhm47</td>\n",
       "      <td>Brigham Young University</td>\n",
       "      <td>education</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>I100051649</td>\n",
       "      <td>https://ror.org/00apdsa62</td>\n",
       "      <td>Privolzhsky Research Medical University</td>\n",
       "      <td>education</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>I100063501</td>\n",
       "      <td>https://ror.org/01qz7fr76</td>\n",
       "      <td>Brighton and Sussex Medical School</td>\n",
       "      <td>education</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>I100066346</td>\n",
       "      <td>https://ror.org/04vnq7t77</td>\n",
       "      <td>University of Stuttgart</td>\n",
       "      <td>education</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>I100072489</td>\n",
       "      <td>https://ror.org/025mx2575</td>\n",
       "      <td>Yeditepe University</td>\n",
       "      <td>education</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "           id                        ror  \\\n",
       "0  I100005738  https://ror.org/047rhhm47   \n",
       "1  I100051649  https://ror.org/00apdsa62   \n",
       "2  I100063501  https://ror.org/01qz7fr76   \n",
       "3  I100066346  https://ror.org/04vnq7t77   \n",
       "4  I100072489  https://ror.org/025mx2575   \n",
       "\n",
       "                              display_name       type  \n",
       "0                 Brigham Young University  education  \n",
       "1  Privolzhsky Research Medical University  education  \n",
       "2       Brighton and Sussex Medical School  education  \n",
       "3                  University of Stuttgart  education  \n",
       "4                      Yeditepe University  education  "
      ]
     },
     "execution_count": 58,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select id, ror, display_name, type \n",
    "         from openalex2022.institutions\n",
    "         where type = \"education\" limit 5;\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5192f848",
   "metadata": {},
   "source": [
    "```like```: 可以进行字符串的模糊匹配\n",
    "* ```%``` means \"any number of character, including none\"\n",
    "* ```_``` means \"one and only one character\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "id": "185ae315",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T06:37:31.720190Z",
     "start_time": "2022-07-08T06:37:31.479601Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>ror</th>\n",
       "      <th>display_name</th>\n",
       "      <th>country_code</th>\n",
       "      <th>type</th>\n",
       "      <th>homepage_url</th>\n",
       "      <th>image_url</th>\n",
       "      <th>image_thumbnail_url</th>\n",
       "      <th>display_name_acroynyms</th>\n",
       "      <th>works_count</th>\n",
       "      <th>cited_by_count</th>\n",
       "      <th>updated_date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>I4210105015</td>\n",
       "      <td>https://ror.org/019wqcg20</td>\n",
       "      <td>Stanford Health Care</td>\n",
       "      <td>US</td>\n",
       "      <td>healthcare</td>\n",
       "      <td>https://stanfordhealthcare.org/</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>209</td>\n",
       "      <td>223</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>I4210120900</td>\n",
       "      <td>https://ror.org/02vzbm991</td>\n",
       "      <td>Stanford Synchrotron Radiation Lightsource</td>\n",
       "      <td>US</td>\n",
       "      <td>facility</td>\n",
       "      <td>https://www-ssrl.slac.stanford.edu/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>64</td>\n",
       "      <td>67</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>I4210133340</td>\n",
       "      <td>https://ror.org/03kezgr11</td>\n",
       "      <td>Stanford Blood Center</td>\n",
       "      <td>US</td>\n",
       "      <td>nonprofit</td>\n",
       "      <td>https://stanfordbloodcenter.org/</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>I4210137306</td>\n",
       "      <td>https://ror.org/03mtd9a03</td>\n",
       "      <td>Stanford Medicine</td>\n",
       "      <td>US</td>\n",
       "      <td>healthcare</td>\n",
       "      <td>http://med.stanford.edu/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>240</td>\n",
       "      <td>260</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>I97018004</td>\n",
       "      <td>https://ror.org/00f54p054</td>\n",
       "      <td>Stanford University</td>\n",
       "      <td>US</td>\n",
       "      <td>education</td>\n",
       "      <td>http://www.stanford.edu/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/b/b7...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/thum...</td>\n",
       "      <td></td>\n",
       "      <td>364648</td>\n",
       "      <td>49556787</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            id                        ror  \\\n",
       "0  I4210105015  https://ror.org/019wqcg20   \n",
       "1  I4210120900  https://ror.org/02vzbm991   \n",
       "2  I4210133340  https://ror.org/03kezgr11   \n",
       "3  I4210137306  https://ror.org/03mtd9a03   \n",
       "4    I97018004  https://ror.org/00f54p054   \n",
       "\n",
       "                                 display_name country_code        type  \\\n",
       "0                        Stanford Health Care           US  healthcare   \n",
       "1  Stanford Synchrotron Radiation Lightsource           US    facility   \n",
       "2                       Stanford Blood Center           US   nonprofit   \n",
       "3                           Stanford Medicine           US  healthcare   \n",
       "4                         Stanford University           US   education   \n",
       "\n",
       "                          homepage_url  \\\n",
       "0      https://stanfordhealthcare.org/   \n",
       "1  https://www-ssrl.slac.stanford.edu/   \n",
       "2     https://stanfordbloodcenter.org/   \n",
       "3             http://med.stanford.edu/   \n",
       "4             http://www.stanford.edu/   \n",
       "\n",
       "                                           image_url  \\\n",
       "0                                                      \n",
       "1  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "2                                                      \n",
       "3  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "4  https://upload.wikimedia.org/wikipedia/en/b/b7...   \n",
       "\n",
       "                                 image_thumbnail_url display_name_acroynyms  \\\n",
       "0                                                                             \n",
       "1  https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "2                                                                             \n",
       "3  https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "4  https://upload.wikimedia.org/wikipedia/en/thum...                          \n",
       "\n",
       "   works_count  cited_by_count updated_date  \n",
       "0          209             223   2022-06-01  \n",
       "1           64              67   2022-06-01  \n",
       "2            6               0   2022-06-01  \n",
       "3          240             260   2022-06-01  \n",
       "4       364648        49556787   2022-06-01  "
      ]
     },
     "execution_count": 59,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql  = \"\"\"select * from openalex2022.institutions \n",
    "        where display_name like '%Stanford%';\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "id": "303d0ee4",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T06:39:17.431260Z",
     "start_time": "2022-07-08T06:39:17.204577Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>ror</th>\n",
       "      <th>display_name</th>\n",
       "      <th>country_code</th>\n",
       "      <th>type</th>\n",
       "      <th>homepage_url</th>\n",
       "      <th>image_url</th>\n",
       "      <th>image_thumbnail_url</th>\n",
       "      <th>display_name_acroynyms</th>\n",
       "      <th>works_count</th>\n",
       "      <th>cited_by_count</th>\n",
       "      <th>updated_date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>I4210105015</td>\n",
       "      <td>https://ror.org/019wqcg20</td>\n",
       "      <td>Stanford Health Care</td>\n",
       "      <td>US</td>\n",
       "      <td>healthcare</td>\n",
       "      <td>https://stanfordhealthcare.org/</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>209</td>\n",
       "      <td>223</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>I4210120900</td>\n",
       "      <td>https://ror.org/02vzbm991</td>\n",
       "      <td>Stanford Synchrotron Radiation Lightsource</td>\n",
       "      <td>US</td>\n",
       "      <td>facility</td>\n",
       "      <td>https://www-ssrl.slac.stanford.edu/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>64</td>\n",
       "      <td>67</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>I4210133340</td>\n",
       "      <td>https://ror.org/03kezgr11</td>\n",
       "      <td>Stanford Blood Center</td>\n",
       "      <td>US</td>\n",
       "      <td>nonprofit</td>\n",
       "      <td>https://stanfordbloodcenter.org/</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>I4210137306</td>\n",
       "      <td>https://ror.org/03mtd9a03</td>\n",
       "      <td>Stanford Medicine</td>\n",
       "      <td>US</td>\n",
       "      <td>healthcare</td>\n",
       "      <td>http://med.stanford.edu/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>240</td>\n",
       "      <td>260</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>I97018004</td>\n",
       "      <td>https://ror.org/00f54p054</td>\n",
       "      <td>Stanford University</td>\n",
       "      <td>US</td>\n",
       "      <td>education</td>\n",
       "      <td>http://www.stanford.edu/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/b/b7...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/thum...</td>\n",
       "      <td></td>\n",
       "      <td>364648</td>\n",
       "      <td>49556787</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            id                        ror  \\\n",
       "0  I4210105015  https://ror.org/019wqcg20   \n",
       "1  I4210120900  https://ror.org/02vzbm991   \n",
       "2  I4210133340  https://ror.org/03kezgr11   \n",
       "3  I4210137306  https://ror.org/03mtd9a03   \n",
       "4    I97018004  https://ror.org/00f54p054   \n",
       "\n",
       "                                 display_name country_code        type  \\\n",
       "0                        Stanford Health Care           US  healthcare   \n",
       "1  Stanford Synchrotron Radiation Lightsource           US    facility   \n",
       "2                       Stanford Blood Center           US   nonprofit   \n",
       "3                           Stanford Medicine           US  healthcare   \n",
       "4                         Stanford University           US   education   \n",
       "\n",
       "                          homepage_url  \\\n",
       "0      https://stanfordhealthcare.org/   \n",
       "1  https://www-ssrl.slac.stanford.edu/   \n",
       "2     https://stanfordbloodcenter.org/   \n",
       "3             http://med.stanford.edu/   \n",
       "4             http://www.stanford.edu/   \n",
       "\n",
       "                                           image_url  \\\n",
       "0                                                      \n",
       "1  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "2                                                      \n",
       "3  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "4  https://upload.wikimedia.org/wikipedia/en/b/b7...   \n",
       "\n",
       "                                 image_thumbnail_url display_name_acroynyms  \\\n",
       "0                                                                             \n",
       "1  https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "2                                                                             \n",
       "3  https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "4  https://upload.wikimedia.org/wikipedia/en/thum...                          \n",
       "\n",
       "   works_count  cited_by_count updated_date  \n",
       "0          209             223   2022-06-01  \n",
       "1           64              67   2022-06-01  \n",
       "2            6               0   2022-06-01  \n",
       "3          240             260   2022-06-01  \n",
       "4       364648        49556787   2022-06-01  "
      ]
     },
     "execution_count": 60,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql  = \"\"\"select * from openalex2022.institutions \n",
    "        where lower(display_name) like '%stanford%';\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5f59d9ab",
   "metadata": {},
   "source": [
    "Date: 可以直接比较以及排序"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "id": "1da3a24a",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T06:40:23.919974Z",
     "start_time": "2022-07-08T06:40:23.869050Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>doi</th>\n",
       "      <th>publication_year</th>\n",
       "      <th>publication_date</th>\n",
       "      <th>type</th>\n",
       "      <th>cited_by_count</th>\n",
       "      <th>is_retracted</th>\n",
       "      <th>is_paratext</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>W3113</td>\n",
       "      <td></td>\n",
       "      <td>2015</td>\n",
       "      <td>2015-02-12</td>\n",
       "      <td></td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>W3238</td>\n",
       "      <td></td>\n",
       "      <td>2005</td>\n",
       "      <td>2005-01-01</td>\n",
       "      <td></td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>W4895</td>\n",
       "      <td></td>\n",
       "      <td>2007</td>\n",
       "      <td>2007-01-01</td>\n",
       "      <td></td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      id doi  publication_year publication_date type  cited_by_count  \\\n",
       "0  W3113                  2015       2015-02-12                    0   \n",
       "1  W3238                  2005       2005-01-01                    0   \n",
       "2  W4895                  2007       2007-01-01                    0   \n",
       "\n",
       "   is_retracted  is_paratext  \n",
       "0             0            0  \n",
       "1             0            0  \n",
       "2             0            0  "
      ]
     },
     "execution_count": 62,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select * from(\n",
    "             select * from openalex2022.works limit 5\n",
    "         )a where publication_date > '2000-01-01';\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "86d4c1a5",
   "metadata": {},
   "source": [
    "is null/ is not null\n",
    "\n",
    "NaN 往往不能用```is null``` 来判断"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "213dd839",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T03:03:29.679584Z",
     "start_time": "2022-07-08T03:03:29.655697Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>author_orcid</th>\n",
       "      <th>activity</th>\n",
       "      <th>department</th>\n",
       "      <th>role</th>\n",
       "      <th>start_date</th>\n",
       "      <th>end_date</th>\n",
       "      <th>city</th>\n",
       "      <th>region</th>\n",
       "      <th>country_code</th>\n",
       "      <th>ringgold_id</th>\n",
       "      <th>fundref_id</th>\n",
       "      <th>grid_id</th>\n",
       "      <th>organization</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0000-0001-5002-6020</td>\n",
       "      <td>education</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>lanzhou</td>\n",
       "      <td>NaN</td>\n",
       "      <td>CN</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>Gansu Academy of Environmental Sciences</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0000-0001-5002-6020</td>\n",
       "      <td>employment</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>lanzhou</td>\n",
       "      <td>NaN</td>\n",
       "      <td>CN</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>Gansu Academy of Environmental Sciences</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0000-0001-5036-8020</td>\n",
       "      <td>employment</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>London</td>\n",
       "      <td>Middlesex</td>\n",
       "      <td>GB</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>Self Employed</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0000-0001-5046-4020</td>\n",
       "      <td>employment</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>哈尔滨</td>\n",
       "      <td>黑龙江</td>\n",
       "      <td>CN</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>哈尔滨医科大学附属第四医院</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0000-0001-5068-3020</td>\n",
       "      <td>employment</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>Tehran</td>\n",
       "      <td>NaN</td>\n",
       "      <td>IR</td>\n",
       "      <td>None</td>\n",
       "      <td>http://dx.doi.org/10.13039/501100005851</td>\n",
       "      <td>None</td>\n",
       "      <td>Shahid Beheshti University of Medical Sciences</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>0000-0001-5069-1020</td>\n",
       "      <td>employment</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>2019-09-01</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>Oliveira de Frades</td>\n",
       "      <td>NaN</td>\n",
       "      <td>PT</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>Instituto do Sorriso Dream Clinic</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>0000-0001-5069-1020</td>\n",
       "      <td>employment</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>2019-09-01</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>Mortágua</td>\n",
       "      <td>NaN</td>\n",
       "      <td>PT</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>Clínica Idialis - Instituto de Reabilitação Oral</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>0000-0001-5069-1020</td>\n",
       "      <td>employment</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>2019-09-01</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>Viseu</td>\n",
       "      <td>NaN</td>\n",
       "      <td>PT</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>Clinica Medijor</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>0000-0001-5088-6020</td>\n",
       "      <td>education</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>2015-09-01</td>\n",
       "      <td>00-00-00</td>\n",
       "      <td>Harkiv</td>\n",
       "      <td>Hаrkìvsʹkа oblаstʹ</td>\n",
       "      <td>UA</td>\n",
       "      <td>256451</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>Harkivs'kij nacional'nij universitet imeni V N...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>0000-0001-5090-7020</td>\n",
       "      <td>education</td>\n",
       "      <td>None</td>\n",
       "      <td>Bacharel em Nutrição</td>\n",
       "      <td>2016-02-00</td>\n",
       "      <td>2020-01-00</td>\n",
       "      <td>Curitiba</td>\n",
       "      <td>PR</td>\n",
       "      <td>BR</td>\n",
       "      <td>217507</td>\n",
       "      <td>None</td>\n",
       "      <td>None</td>\n",
       "      <td>Universidade Tuiuti do Paraná</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          author_orcid    activity department                   role  \\\n",
       "0  0000-0001-5002-6020   education       None                   None   \n",
       "1  0000-0001-5002-6020  employment       None                   None   \n",
       "2  0000-0001-5036-8020  employment       None                   None   \n",
       "3  0000-0001-5046-4020  employment       None                   None   \n",
       "4  0000-0001-5068-3020  employment       None                   None   \n",
       "5  0000-0001-5069-1020  employment       None                   None   \n",
       "6  0000-0001-5069-1020  employment       None                   None   \n",
       "7  0000-0001-5069-1020  employment       None                   None   \n",
       "8  0000-0001-5088-6020   education       None                   None   \n",
       "9  0000-0001-5090-7020   education       None  Bacharel em Nutrição    \n",
       "\n",
       "   start_date    end_date                city              region  \\\n",
       "0    00-00-00    00-00-00             lanzhou                 NaN   \n",
       "1    00-00-00    00-00-00             lanzhou                 NaN   \n",
       "2    00-00-00    00-00-00              London           Middlesex   \n",
       "3    00-00-00    00-00-00                 哈尔滨                 黑龙江   \n",
       "4    00-00-00    00-00-00              Tehran                 NaN   \n",
       "5  2019-09-01    00-00-00  Oliveira de Frades                 NaN   \n",
       "6  2019-09-01    00-00-00            Mortágua                 NaN   \n",
       "7  2019-09-01    00-00-00               Viseu                 NaN   \n",
       "8  2015-09-01    00-00-00              Harkiv  Hаrkìvsʹkа oblаstʹ   \n",
       "9  2016-02-00  2020-01-00            Curitiba                  PR   \n",
       "\n",
       "  country_code ringgold_id                               fundref_id grid_id  \\\n",
       "0           CN        None                                     None    None   \n",
       "1           CN        None                                     None    None   \n",
       "2           GB        None                                     None    None   \n",
       "3           CN        None                                     None    None   \n",
       "4           IR        None  http://dx.doi.org/10.13039/501100005851    None   \n",
       "5           PT        None                                     None    None   \n",
       "6           PT        None                                     None    None   \n",
       "7           PT        None                                     None    None   \n",
       "8           UA      256451                                     None    None   \n",
       "9           BR      217507                                     None    None   \n",
       "\n",
       "                                        organization  \n",
       "0            Gansu Academy of Environmental Sciences  \n",
       "1            Gansu Academy of Environmental Sciences  \n",
       "2                                      Self Employed  \n",
       "3                                      哈尔滨医科大学附属第四医院  \n",
       "4     Shahid Beheshti University of Medical Sciences  \n",
       "5                  Instituto do Sorriso Dream Clinic  \n",
       "6   Clínica Idialis - Instituto de Reabilitação Oral  \n",
       "7                                    Clinica Medijor  \n",
       "8  Harkivs'kij nacional'nij universitet imeni V N...  \n",
       "9                      Universidade Tuiuti do Paraná  "
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select * \n",
    "         from openalex2022.author_orciddb2022  \n",
    "         where department is null limit 10;\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "90a5de9e",
   "metadata": {},
   "source": [
    "### Complex query\n",
    "嵌套询问\n",
    "```select * from (select * from table where constrains) table_name where constrains```\n",
    "\n",
    "**注意： Every derived table must have its own alias** 需要给每一个选择出来的表格命名"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 64,
   "id": "95712c68",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T06:42:50.934708Z",
     "start_time": "2022-07-08T06:42:50.561656Z"
    },
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>ror</th>\n",
       "      <th>display_name</th>\n",
       "      <th>country_code</th>\n",
       "      <th>type</th>\n",
       "      <th>homepage_url</th>\n",
       "      <th>image_url</th>\n",
       "      <th>image_thumbnail_url</th>\n",
       "      <th>display_name_acroynyms</th>\n",
       "      <th>works_count</th>\n",
       "      <th>cited_by_count</th>\n",
       "      <th>updated_date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>I10011244</td>\n",
       "      <td>https://ror.org/007gf6e19</td>\n",
       "      <td>Huanggang Normal University</td>\n",
       "      <td>CN</td>\n",
       "      <td>education</td>\n",
       "      <td>http://www.hgnc.net/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>2829</td>\n",
       "      <td>34850</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>I100135526</td>\n",
       "      <td>https://ror.org/045pn2j94</td>\n",
       "      <td>BGI Group</td>\n",
       "      <td>CN</td>\n",
       "      <td>company</td>\n",
       "      <td>http://www.genomics.cn/index</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>1260</td>\n",
       "      <td>506183</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>I100188998</td>\n",
       "      <td>https://ror.org/04e6y1282</td>\n",
       "      <td>Harbin University of Science and Technology</td>\n",
       "      <td>CN</td>\n",
       "      <td>education</td>\n",
       "      <td>http://www.hrbust.edu.cn/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/c/cd...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/thum...</td>\n",
       "      <td></td>\n",
       "      <td>13154</td>\n",
       "      <td>184997</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>I100286613</td>\n",
       "      <td>https://ror.org/044ysd349</td>\n",
       "      <td>Hunan Institute of Science and Technology</td>\n",
       "      <td>CN</td>\n",
       "      <td>education</td>\n",
       "      <td>http://www.hnist.cn/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/9/9f...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/thum...</td>\n",
       "      <td></td>\n",
       "      <td>3708</td>\n",
       "      <td>42671</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>I100357981</td>\n",
       "      <td>https://ror.org/037ejjy86</td>\n",
       "      <td>Wannan Medical College</td>\n",
       "      <td>CN</td>\n",
       "      <td>healthcare</td>\n",
       "      <td>http://www.wnmc.edu.cn</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>4938</td>\n",
       "      <td>82086</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4850</th>\n",
       "      <td>I98822032</td>\n",
       "      <td></td>\n",
       "      <td>University of Shanghai</td>\n",
       "      <td>CN</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>704</td>\n",
       "      <td>6373</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4851</th>\n",
       "      <td>I98834328</td>\n",
       "      <td>https://ror.org/059djzq42</td>\n",
       "      <td>Wuyi University</td>\n",
       "      <td>CN</td>\n",
       "      <td>education</td>\n",
       "      <td>http://www.wuyiu.edu.cn/index.html</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/4/49...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/thum...</td>\n",
       "      <td></td>\n",
       "      <td>6136</td>\n",
       "      <td>68622</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4852</th>\n",
       "      <td>I99065089</td>\n",
       "      <td>https://ror.org/03cve4549</td>\n",
       "      <td>Tsinghua University</td>\n",
       "      <td>CN</td>\n",
       "      <td>education</td>\n",
       "      <td>http://www.tsinghua.edu.cn/publish/newthuen/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>233548</td>\n",
       "      <td>13214293</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4853</th>\n",
       "      <td>I9916479</td>\n",
       "      <td>https://ror.org/00ms48f15</td>\n",
       "      <td>Air Force Medical University</td>\n",
       "      <td>CN</td>\n",
       "      <td>education</td>\n",
       "      <td>https://www.fmmu.edu.cn/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/c/c7...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/thum...</td>\n",
       "      <td></td>\n",
       "      <td>34785</td>\n",
       "      <td>1989475</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4854</th>\n",
       "      <td>I99364987</td>\n",
       "      <td></td>\n",
       "      <td>Hunan College of Finance and Economics</td>\n",
       "      <td>CN</td>\n",
       "      <td></td>\n",
       "      <td>http://www.hnczzk.com/index.aspx</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>210</td>\n",
       "      <td>379</td>\n",
       "      <td>2022-06-01</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>4855 rows × 12 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "              id                        ror  \\\n",
       "0      I10011244  https://ror.org/007gf6e19   \n",
       "1     I100135526  https://ror.org/045pn2j94   \n",
       "2     I100188998  https://ror.org/04e6y1282   \n",
       "3     I100286613  https://ror.org/044ysd349   \n",
       "4     I100357981  https://ror.org/037ejjy86   \n",
       "...          ...                        ...   \n",
       "4850   I98822032                              \n",
       "4851   I98834328  https://ror.org/059djzq42   \n",
       "4852   I99065089  https://ror.org/03cve4549   \n",
       "4853    I9916479  https://ror.org/00ms48f15   \n",
       "4854   I99364987                              \n",
       "\n",
       "                                     display_name country_code        type  \\\n",
       "0                     Huanggang Normal University           CN   education   \n",
       "1                                       BGI Group           CN     company   \n",
       "2     Harbin University of Science and Technology           CN   education   \n",
       "3       Hunan Institute of Science and Technology           CN   education   \n",
       "4                          Wannan Medical College           CN  healthcare   \n",
       "...                                           ...          ...         ...   \n",
       "4850                       University of Shanghai           CN               \n",
       "4851                              Wuyi University           CN   education   \n",
       "4852                          Tsinghua University           CN   education   \n",
       "4853                 Air Force Medical University           CN   education   \n",
       "4854       Hunan College of Finance and Economics           CN               \n",
       "\n",
       "                                      homepage_url  \\\n",
       "0                             http://www.hgnc.net/   \n",
       "1                     http://www.genomics.cn/index   \n",
       "2                        http://www.hrbust.edu.cn/   \n",
       "3                             http://www.hnist.cn/   \n",
       "4                           http://www.wnmc.edu.cn   \n",
       "...                                            ...   \n",
       "4850                                                 \n",
       "4851            http://www.wuyiu.edu.cn/index.html   \n",
       "4852  http://www.tsinghua.edu.cn/publish/newthuen/   \n",
       "4853                      https://www.fmmu.edu.cn/   \n",
       "4854              http://www.hnczzk.com/index.aspx   \n",
       "\n",
       "                                              image_url  \\\n",
       "0     https://upload.wikimedia.org/wikipedia/commons...   \n",
       "1     https://upload.wikimedia.org/wikipedia/commons...   \n",
       "2     https://upload.wikimedia.org/wikipedia/en/c/cd...   \n",
       "3     https://upload.wikimedia.org/wikipedia/en/9/9f...   \n",
       "4                                                         \n",
       "...                                                 ...   \n",
       "4850  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "4851  https://upload.wikimedia.org/wikipedia/en/4/49...   \n",
       "4852  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "4853  https://upload.wikimedia.org/wikipedia/en/c/c7...   \n",
       "4854                                                      \n",
       "\n",
       "                                    image_thumbnail_url  \\\n",
       "0     https://upload.wikimedia.org/wikipedia/commons...   \n",
       "1     https://upload.wikimedia.org/wikipedia/commons...   \n",
       "2     https://upload.wikimedia.org/wikipedia/en/thum...   \n",
       "3     https://upload.wikimedia.org/wikipedia/en/thum...   \n",
       "4                                                         \n",
       "...                                                 ...   \n",
       "4850  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "4851  https://upload.wikimedia.org/wikipedia/en/thum...   \n",
       "4852  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "4853  https://upload.wikimedia.org/wikipedia/en/thum...   \n",
       "4854                                                      \n",
       "\n",
       "     display_name_acroynyms  works_count  cited_by_count updated_date  \n",
       "0                                   2829           34850   2022-06-01  \n",
       "1                                   1260          506183   2022-06-01  \n",
       "2                                  13154          184997   2022-06-01  \n",
       "3                                   3708           42671   2022-06-01  \n",
       "4                                   4938           82086   2022-06-01  \n",
       "...                     ...          ...             ...          ...  \n",
       "4850                                 704            6373   2022-06-01  \n",
       "4851                                6136           68622   2022-06-01  \n",
       "4852                              233548        13214293   2022-06-01  \n",
       "4853                               34785         1989475   2022-06-01  \n",
       "4854                                 210             379   2022-06-01  \n",
       "\n",
       "[4855 rows x 12 columns]"
      ]
     },
     "execution_count": 64,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select *\n",
    "         from (\n",
    "             select *\n",
    "             from openalex2022.institutions\n",
    "             where country_code = 'CN'\n",
    "         ) a;\"\"\"   \n",
    "# 错误示范\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "271c491a",
   "metadata": {},
   "source": [
    "## Functions\n",
    "我们可以输出经过函数计算之后的数值"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5c74ba9f",
   "metadata": {},
   "source": [
    "### 字符处理 [String functions](https://dev.mysql.com/doc/refman/8.0/en/string-functions.html)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "id": "82ed32b8",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T06:44:36.922559Z",
     "start_time": "2022-07-08T06:44:36.881343Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>work_id</th>\n",
       "      <th>author_position</th>\n",
       "      <th>author_id</th>\n",
       "      <th>institution_id</th>\n",
       "      <th>after</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>W761</td>\n",
       "      <td>first</td>\n",
       "      <td>A2689932668</td>\n",
       "      <td>\\r</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>W3113</td>\n",
       "      <td>first</td>\n",
       "      <td>A2117169099</td>\n",
       "      <td>\\r</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>W3113</td>\n",
       "      <td>last</td>\n",
       "      <td>A2137558726</td>\n",
       "      <td>\\r</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>W3238</td>\n",
       "      <td>first</td>\n",
       "      <td>A3140448858</td>\n",
       "      <td>\\r</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>W4272</td>\n",
       "      <td>first</td>\n",
       "      <td>A2143464874</td>\n",
       "      <td>\\r</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>W4895</td>\n",
       "      <td>first</td>\n",
       "      <td>A2119238105</td>\n",
       "      <td>\\r</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>W5388</td>\n",
       "      <td>first</td>\n",
       "      <td>A2659745463</td>\n",
       "      <td>\\r</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>W7230</td>\n",
       "      <td>first</td>\n",
       "      <td>A2700237503</td>\n",
       "      <td>I142823887\\r</td>\n",
       "      <td>I142823887</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>W9107</td>\n",
       "      <td>first</td>\n",
       "      <td>A2702199955</td>\n",
       "      <td>\\r</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>W9107</td>\n",
       "      <td>last</td>\n",
       "      <td>A2479910197</td>\n",
       "      <td>\\r</td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  work_id author_position    author_id institution_id       after\n",
       "0    W761           first  A2689932668             \\r            \n",
       "1   W3113           first  A2117169099             \\r            \n",
       "2   W3113            last  A2137558726             \\r            \n",
       "3   W3238           first  A3140448858             \\r            \n",
       "4   W4272           first  A2143464874             \\r            \n",
       "5   W4895           first  A2119238105             \\r            \n",
       "6   W5388           first  A2659745463             \\r            \n",
       "7   W7230           first  A2700237503   I142823887\\r  I142823887\n",
       "8   W9107           first  A2702199955             \\r            \n",
       "9   W9107            last  A2479910197             \\r            "
      ]
     },
     "execution_count": 65,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select * ,trim('\\r' from institution_id) as after  \n",
    "         from openalex2022.works_authorships limit 10;\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7bcc79cb",
   "metadata": {},
   "source": [
    "### [Numeric Functions and Operators](https://dev.mysql.com/doc/refman/8.0/en/numeric-functions.html)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "435ef9cc",
   "metadata": {},
   "source": [
    "## Distinct and Aggregation\n",
    "```distinct```\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "id": "9eee1a9c",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T03:27:27.414214Z",
     "start_time": "2022-07-08T03:27:26.974418Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>author_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>A2700237503</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>A2994586336</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>A2161559818</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>A2627178026</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>A2992935001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20796</th>\n",
       "      <td>A2113780445</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20797</th>\n",
       "      <td>A2507125562</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20798</th>\n",
       "      <td>A2192118702</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20799</th>\n",
       "      <td>A2355447610</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20800</th>\n",
       "      <td>A2507915540</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>20801 rows × 1 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "         author_id\n",
       "0      A2700237503\n",
       "1      A2994586336\n",
       "2      A2161559818\n",
       "3      A2627178026\n",
       "4      A2992935001\n",
       "...            ...\n",
       "20796  A2113780445\n",
       "20797  A2507125562\n",
       "20798  A2192118702\n",
       "20799  A2355447610\n",
       "20800  A2507915540\n",
       "\n",
       "[20801 rows x 1 columns]"
      ]
     },
     "execution_count": 30,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select distinct author_id\n",
    "from openalex2022.works_authorships where institution_id = 'I142823887\\r';\"\"\"\n",
    "pd.read_sql(sql, con = db)\n",
    "# 20801\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8ee9da50",
   "metadata": {},
   "source": [
    "### Aggregation functions\n",
    "将多行变成一行，常用的函数有： ```count(*)/count(col), min(col), max(col), stddev(col), avg(col)```\n",
    "\n",
    "**注意：使用的函数是从多到一**"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "id": "28261b39",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T04:01:43.352438Z",
     "start_time": "2022-07-08T04:01:43.260982Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>institution_id</th>\n",
       "      <th>count(*)</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>\\r</td>\n",
       "      <td>9491</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>I142823887\\r</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>I142444530\\r</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>I4210157153\\r</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>I252758333\\r</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>277</th>\n",
       "      <td>I200845125\\r</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>278</th>\n",
       "      <td>I188538660\\r</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>279</th>\n",
       "      <td>I181233156\\r</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>280</th>\n",
       "      <td>I1336096307\\r</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>281</th>\n",
       "      <td>I1280527723\\r</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>282 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    institution_id  count(*)\n",
       "0               \\r      9491\n",
       "1     I142823887\\r         2\n",
       "2     I142444530\\r         1\n",
       "3    I4210157153\\r         1\n",
       "4     I252758333\\r         2\n",
       "..             ...       ...\n",
       "277   I200845125\\r         3\n",
       "278   I188538660\\r         1\n",
       "279   I181233156\\r         1\n",
       "280  I1336096307\\r         2\n",
       "281  I1280527723\\r         1\n",
       "\n",
       "[282 rows x 2 columns]"
      ]
     },
     "execution_count": 37,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select institution_id,count(*) from(\n",
    "select * from openalex2022.works_authorships limit 10000) a group by institution_id;\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "36d0aea0",
   "metadata": {},
   "source": [
    "## [Window Function](https://dev.mysql.com/doc/refman/8.0/en/window-functions.html)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dfec0966",
   "metadata": {},
   "source": [
    "从institutions_counts_by_year 中得到哪一年产出了最多的works"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "id": "7429b672",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T04:19:10.470673Z",
     "start_time": "2022-07-08T04:19:01.738791Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>institution_id</th>\n",
       "      <th>year</th>\n",
       "      <th>works_count</th>\n",
       "      <th>cited_by_count</th>\n",
       "      <th>rank of works_count</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>I100005738</td>\n",
       "      <td>2021</td>\n",
       "      <td>2127</td>\n",
       "      <td>195343</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>I100005738</td>\n",
       "      <td>2015</td>\n",
       "      <td>2095</td>\n",
       "      <td>119331</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>I100005738</td>\n",
       "      <td>2014</td>\n",
       "      <td>2013</td>\n",
       "      <td>114734</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>I100005738</td>\n",
       "      <td>2013</td>\n",
       "      <td>1929</td>\n",
       "      <td>103387</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>I100005738</td>\n",
       "      <td>2020</td>\n",
       "      <td>1874</td>\n",
       "      <td>164114</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>630576</th>\n",
       "      <td>I99989288</td>\n",
       "      <td>2021</td>\n",
       "      <td>0</td>\n",
       "      <td>39</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>630577</th>\n",
       "      <td>I99989288</td>\n",
       "      <td>2018</td>\n",
       "      <td>0</td>\n",
       "      <td>11</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>630578</th>\n",
       "      <td>I99989288</td>\n",
       "      <td>2015</td>\n",
       "      <td>0</td>\n",
       "      <td>24</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>630579</th>\n",
       "      <td>I99989288</td>\n",
       "      <td>2014</td>\n",
       "      <td>0</td>\n",
       "      <td>24</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>630580</th>\n",
       "      <td>I99989288</td>\n",
       "      <td>2017</td>\n",
       "      <td>0</td>\n",
       "      <td>15</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>630581 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "       institution_id  year  works_count  cited_by_count  rank of works_count\n",
       "0          I100005738  2021         2127          195343                    1\n",
       "1          I100005738  2015         2095          119331                    2\n",
       "2          I100005738  2014         2013          114734                    3\n",
       "3          I100005738  2013         1929          103387                    4\n",
       "4          I100005738  2020         1874          164114                    5\n",
       "...               ...   ...          ...             ...                  ...\n",
       "630576      I99989288  2021            0              39                    5\n",
       "630577      I99989288  2018            0              11                    5\n",
       "630578      I99989288  2015            0              24                    5\n",
       "630579      I99989288  2014            0              24                    5\n",
       "630580      I99989288  2017            0              15                    5\n",
       "\n",
       "[630581 rows x 5 columns]"
      ]
     },
     "execution_count": 39,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select *, rank() over w 'rank of works_count'\n",
    "         from openalex2022.institutions_counts_by_year\n",
    "         window w as (partition by institution_id order by works_count desc );\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9ef3e88c",
   "metadata": {},
   "source": [
    "## Multiple Tables(join)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "494f7673",
   "metadata": {},
   "source": [
    "### Inner join(default join)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "id": "226a8688",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2022-07-08T05:30:17.304441Z",
     "start_time": "2022-07-08T05:30:17.087290Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>ror</th>\n",
       "      <th>display_name</th>\n",
       "      <th>country_code</th>\n",
       "      <th>type</th>\n",
       "      <th>homepage_url</th>\n",
       "      <th>image_url</th>\n",
       "      <th>image_thumbnail_url</th>\n",
       "      <th>display_name_acroynyms</th>\n",
       "      <th>works_count</th>\n",
       "      <th>cited_by_count</th>\n",
       "      <th>updated_date</th>\n",
       "      <th>institution_id</th>\n",
       "      <th>city</th>\n",
       "      <th>geonames_city_id</th>\n",
       "      <th>region</th>\n",
       "      <th>country_code</th>\n",
       "      <th>country</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>I100005738</td>\n",
       "      <td>https://ror.org/047rhhm47</td>\n",
       "      <td>Brigham Young University</td>\n",
       "      <td>US</td>\n",
       "      <td>education</td>\n",
       "      <td>http://home.byu.edu/home/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>45306</td>\n",
       "      <td>2012739</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I100005738</td>\n",
       "      <td>Provo</td>\n",
       "      <td>5780026.0</td>\n",
       "      <td>Utah</td>\n",
       "      <td>US</td>\n",
       "      <td>United States</td>\n",
       "      <td>40.2500</td>\n",
       "      <td>-111.6500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>I100019715</td>\n",
       "      <td>https://ror.org/04m1j1t24</td>\n",
       "      <td>Australian Institute of Criminology</td>\n",
       "      <td>AU</td>\n",
       "      <td>government</td>\n",
       "      <td>http://www.aic.gov.au/</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>265</td>\n",
       "      <td>3414</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I100019715</td>\n",
       "      <td>Canberra</td>\n",
       "      <td>2172517.0</td>\n",
       "      <td>Australian Capital Territory</td>\n",
       "      <td>AU</td>\n",
       "      <td>Australia</td>\n",
       "      <td>-35.3148</td>\n",
       "      <td>149.1310</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>I100051649</td>\n",
       "      <td>https://ror.org/00apdsa62</td>\n",
       "      <td>Privolzhsky Research Medical University</td>\n",
       "      <td>RU</td>\n",
       "      <td>education</td>\n",
       "      <td>https://pimunn.ru/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>1306</td>\n",
       "      <td>24456</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I100051649</td>\n",
       "      <td>Nizhny Novgorod</td>\n",
       "      <td>520555.0</td>\n",
       "      <td></td>\n",
       "      <td>RU</td>\n",
       "      <td>Russia</td>\n",
       "      <td>56.3292</td>\n",
       "      <td>44.0095</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>I100060924</td>\n",
       "      <td></td>\n",
       "      <td>Earlham School of Religion</td>\n",
       "      <td>US</td>\n",
       "      <td></td>\n",
       "      <td>http://esr.earlham.edu/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>54</td>\n",
       "      <td>15</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I100060924</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>US</td>\n",
       "      <td></td>\n",
       "      <td>39.8263</td>\n",
       "      <td>-84.9101</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>I100063501</td>\n",
       "      <td>https://ror.org/01qz7fr76</td>\n",
       "      <td>Brighton and Sussex Medical School</td>\n",
       "      <td>GB</td>\n",
       "      <td>education</td>\n",
       "      <td>https://www.bsms.ac.uk/index.aspx</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>5002</td>\n",
       "      <td>210963</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I100063501</td>\n",
       "      <td>Brighton</td>\n",
       "      <td>2654710.0</td>\n",
       "      <td></td>\n",
       "      <td>GB</td>\n",
       "      <td>United Kingdom</td>\n",
       "      <td>50.8650</td>\n",
       "      <td>-0.0850</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>995</th>\n",
       "      <td>I115304662</td>\n",
       "      <td>https://ror.org/006zjws59</td>\n",
       "      <td>University of Vic</td>\n",
       "      <td>ES</td>\n",
       "      <td>education</td>\n",
       "      <td>http://www.uvic-ucc.cat/en</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>2797</td>\n",
       "      <td>41065</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I115304662</td>\n",
       "      <td>Vic</td>\n",
       "      <td>3106050.0</td>\n",
       "      <td></td>\n",
       "      <td>ES</td>\n",
       "      <td>Spain</td>\n",
       "      <td>41.9338</td>\n",
       "      <td>2.2472</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>996</th>\n",
       "      <td>I115306242</td>\n",
       "      <td></td>\n",
       "      <td>American Industrial Hygiene Association</td>\n",
       "      <td>US</td>\n",
       "      <td></td>\n",
       "      <td>http://www.aiha.org/</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>33</td>\n",
       "      <td>3101</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I115306242</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>US</td>\n",
       "      <td></td>\n",
       "      <td>38.8418</td>\n",
       "      <td>-77.3089</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>997</th>\n",
       "      <td>I115312011</td>\n",
       "      <td>https://ror.org/042z8c185</td>\n",
       "      <td>Tarkio College</td>\n",
       "      <td>US</td>\n",
       "      <td>education</td>\n",
       "      <td>http://tarkioalumni.org/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/commons...</td>\n",
       "      <td></td>\n",
       "      <td>12</td>\n",
       "      <td>20</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I115312011</td>\n",
       "      <td>Tarkio</td>\n",
       "      <td>5057486.0</td>\n",
       "      <td>Missouri</td>\n",
       "      <td>US</td>\n",
       "      <td>United States</td>\n",
       "      <td>40.4405</td>\n",
       "      <td>-95.3785</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>998</th>\n",
       "      <td>I115314387</td>\n",
       "      <td>https://ror.org/01afspn38</td>\n",
       "      <td>Prairie State College</td>\n",
       "      <td>US</td>\n",
       "      <td>education</td>\n",
       "      <td>http://prairiestate.edu/</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/1/17...</td>\n",
       "      <td>https://upload.wikimedia.org/wikipedia/en/thum...</td>\n",
       "      <td></td>\n",
       "      <td>27</td>\n",
       "      <td>2933</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I115314387</td>\n",
       "      <td>Chicago Heights</td>\n",
       "      <td>4887442.0</td>\n",
       "      <td>Illinois</td>\n",
       "      <td>US</td>\n",
       "      <td>United States</td>\n",
       "      <td>41.5253</td>\n",
       "      <td>-87.6389</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>999</th>\n",
       "      <td>I115343741</td>\n",
       "      <td>https://ror.org/05p275942</td>\n",
       "      <td>Pacific College of Oriental Medicine</td>\n",
       "      <td>US</td>\n",
       "      <td>education</td>\n",
       "      <td>http://www.pacificcollege.edu/</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>61</td>\n",
       "      <td>1041</td>\n",
       "      <td>2022-06-01</td>\n",
       "      <td>I115343741</td>\n",
       "      <td>San Diego</td>\n",
       "      <td>5391811.0</td>\n",
       "      <td>California</td>\n",
       "      <td>US</td>\n",
       "      <td>United States</td>\n",
       "      <td>32.7784</td>\n",
       "      <td>-117.1610</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1000 rows × 20 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "             id                        ror  \\\n",
       "0    I100005738  https://ror.org/047rhhm47   \n",
       "1    I100019715  https://ror.org/04m1j1t24   \n",
       "2    I100051649  https://ror.org/00apdsa62   \n",
       "3    I100060924                              \n",
       "4    I100063501  https://ror.org/01qz7fr76   \n",
       "..          ...                        ...   \n",
       "995  I115304662  https://ror.org/006zjws59   \n",
       "996  I115306242                              \n",
       "997  I115312011  https://ror.org/042z8c185   \n",
       "998  I115314387  https://ror.org/01afspn38   \n",
       "999  I115343741  https://ror.org/05p275942   \n",
       "\n",
       "                                display_name country_code        type  \\\n",
       "0                   Brigham Young University           US   education   \n",
       "1        Australian Institute of Criminology           AU  government   \n",
       "2    Privolzhsky Research Medical University           RU   education   \n",
       "3                 Earlham School of Religion           US               \n",
       "4         Brighton and Sussex Medical School           GB   education   \n",
       "..                                       ...          ...         ...   \n",
       "995                        University of Vic           ES   education   \n",
       "996  American Industrial Hygiene Association           US               \n",
       "997                           Tarkio College           US   education   \n",
       "998                    Prairie State College           US   education   \n",
       "999     Pacific College of Oriental Medicine           US   education   \n",
       "\n",
       "                          homepage_url  \\\n",
       "0            http://home.byu.edu/home/   \n",
       "1               http://www.aic.gov.au/   \n",
       "2                   https://pimunn.ru/   \n",
       "3              http://esr.earlham.edu/   \n",
       "4    https://www.bsms.ac.uk/index.aspx   \n",
       "..                                 ...   \n",
       "995         http://www.uvic-ucc.cat/en   \n",
       "996               http://www.aiha.org/   \n",
       "997           http://tarkioalumni.org/   \n",
       "998           http://prairiestate.edu/   \n",
       "999     http://www.pacificcollege.edu/   \n",
       "\n",
       "                                             image_url  \\\n",
       "0    https://upload.wikimedia.org/wikipedia/commons...   \n",
       "1                                                        \n",
       "2    https://upload.wikimedia.org/wikipedia/commons...   \n",
       "3    https://upload.wikimedia.org/wikipedia/commons...   \n",
       "4    https://upload.wikimedia.org/wikipedia/commons...   \n",
       "..                                                 ...   \n",
       "995  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "996                                                      \n",
       "997  https://upload.wikimedia.org/wikipedia/commons...   \n",
       "998  https://upload.wikimedia.org/wikipedia/en/1/17...   \n",
       "999                                                      \n",
       "\n",
       "                                   image_thumbnail_url display_name_acroynyms  \\\n",
       "0    https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "1                                                                               \n",
       "2    https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "3    https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "4    https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "..                                                 ...                    ...   \n",
       "995  https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "996                                                                             \n",
       "997  https://upload.wikimedia.org/wikipedia/commons...                          \n",
       "998  https://upload.wikimedia.org/wikipedia/en/thum...                          \n",
       "999                                                                             \n",
       "\n",
       "     works_count  cited_by_count updated_date institution_id             city  \\\n",
       "0          45306         2012739   2022-06-01     I100005738            Provo   \n",
       "1            265            3414   2022-06-01     I100019715         Canberra   \n",
       "2           1306           24456   2022-06-01     I100051649  Nizhny Novgorod   \n",
       "3             54              15   2022-06-01     I100060924                    \n",
       "4           5002          210963   2022-06-01     I100063501         Brighton   \n",
       "..           ...             ...          ...            ...              ...   \n",
       "995         2797           41065   2022-06-01     I115304662              Vic   \n",
       "996           33            3101   2022-06-01     I115306242                    \n",
       "997           12              20   2022-06-01     I115312011           Tarkio   \n",
       "998           27            2933   2022-06-01     I115314387  Chicago Heights   \n",
       "999           61            1041   2022-06-01     I115343741        San Diego   \n",
       "\n",
       "    geonames_city_id                        region country_code  \\\n",
       "0          5780026.0                          Utah           US   \n",
       "1          2172517.0  Australian Capital Territory           AU   \n",
       "2           520555.0                                         RU   \n",
       "3                                                            US   \n",
       "4          2654710.0                                         GB   \n",
       "..               ...                           ...          ...   \n",
       "995        3106050.0                                         ES   \n",
       "996                                                          US   \n",
       "997        5057486.0                      Missouri           US   \n",
       "998        4887442.0                      Illinois           US   \n",
       "999        5391811.0                    California           US   \n",
       "\n",
       "            country  latitude  longitude  \n",
       "0     United States   40.2500  -111.6500  \n",
       "1         Australia  -35.3148   149.1310  \n",
       "2            Russia   56.3292    44.0095  \n",
       "3                     39.8263   -84.9101  \n",
       "4    United Kingdom   50.8650    -0.0850  \n",
       "..              ...       ...        ...  \n",
       "995           Spain   41.9338     2.2472  \n",
       "996                   38.8418   -77.3089  \n",
       "997   United States   40.4405   -95.3785  \n",
       "998   United States   41.5253   -87.6389  \n",
       "999   United States   32.7784  -117.1610  \n",
       "\n",
       "[1000 rows x 20 columns]"
      ]
     },
     "execution_count": 45,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sql = \"\"\"select * from openalex2022.institutions i1 \n",
    "         join openalex2022.institutions_geo i2  \n",
    "         on i1.id = i2.institution_id limit 1000;\"\"\"\n",
    "pd.read_sql(sql, con = db)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0867e7ee",
   "metadata": {},
   "source": [
    "可以理解为：  ```select * from i1, i2 where i1.id  = i2.institution_id```"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7da65384",
   "metadata": {},
   "source": [
    "### Outer join\n",
    "left outer join: 若不存在匹配则会出现```null```"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5cca4789",
   "metadata": {},
   "source": [
    "## Set Operators\n",
    "- union\n",
    "- intersect\n",
    "- except\n",
    "\n",
    "[built in function](https://dev.mysql.com/doc/refman/8.0/en/built-in-function-reference.html)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.2"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {
    "height": "calc(100% - 180px)",
    "left": "10px",
    "top": "150px",
    "width": "204px"
   },
   "toc_section_display": true,
   "toc_window_display": true
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
